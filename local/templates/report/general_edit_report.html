{literal}
<script type="text/javascript"  language="JavaScript">
<!--
function addTemplate(reportId)
{
	var tbl = document.getElementById("template");

	var input = document.createElement("input");
	input.name = "new_templates[][name]";
	input.type = "text";
	input.value = "New Template";
	input.size = "20";

	var bdown = document.createElement("a");
	bdown.href ="download_template/0?report_id="+reportId;
	bdown.appendChild(document.createTextNode("Download"));

	var bdelete = document.createElement("a");
	bdelete.setAttribute('onClick',"deleteNewRow(this); return false;");
	bdelete.href = "#";
	bdelete.appendChild(document.createTextNode("Delete"));

	var ifile = document.createElement("input");
	ifile.type="file";
	ifile.name="new_template_file[]";
	ifile.size=10;



	var lastRow = tbl.rows.length;
	var row = tbl.insertRow(lastRow)

	var cell1 = row.insertCell(0);
	var cell2 = row.insertCell(1);
	var cell3 = row.insertCell(2);
	var cell4 = row.insertCell(3);

	cell1.appendChild(input);
	cell2.appendChild(bdown);
	cell3.appendChild(ifile);
	cell4.appendChild(bdelete);
}
function deleteNewRow(button) {
	var name = button.parentNode.parentNode.firstChild.firstChild.value;
	if (confirm("Are you sure you want to delete template: "+name)) {
		var tbl = button.parentNode.parentNode.parentNode.parentNode;
		tbl.deleteRow(button.parentNode.parentNode.sectionRowIndex);
	}
}
function deleteTemplate(button,template_id) {
	var name = button.parentNode.parentNode.getElementsByTagName('td').item(0).firstChild.value;
	if (confirm("Are you sure you want to delete template: "+name)) {
		var tbl = button.parentNode.parentNode.parentNode.parentNode;
		tbl.deleteRow(button.parentNode.parentNode.sectionRowIndex);

		var hidden = document.createElement("input");
		hidden.name = "deleted_templates[]";
		hidden.value = template_id;
		hidden.type = "hidden";
		document.getElementById('template').parentNode.appendChild(hidden);
	}
}
-->
</script>
<style type="text/css">
	#template td {
		padding: 1px;
	}
</style>
{/literal}
<table width="100%"  border="0" cellspacing="0" cellpadding="8">
            <tr>
		    <td>
			    {if $report->id > 0}
			    <h2>Edit Report</h2>
			    {else}
			    <h2>Add Report</h2>
			    {/if}

                  <p>Update information, click update to save changes</p>


  <form name="report" id="h3sForm" method="post" action="{$TOP_ACTION}" enctype="multipart/form-data">
	<fieldset>
		{if $report->get('id') > 0}
		<h3>Report Details for <i>{$report->get_label()}</i></h3>
		{/if}
		<fieldset class="radio">
		<h4>Report Definition</h4>
<table>
	<!--<tr>
		<td colspan="2">
		{if $error}
			{$error}<br><br>
		{/if}
		{if $messages}
			{$messages}<br><br>
		{/if}
		</td>
	</tr>-->
	<tr>
		<td>Title:&nbsp;</td>
		<td><input type="text" name="label" size="30" value="{$report->get_label()}"></td>
	</tr>
	<tr>
		<td>Description:&nbsp;</td>
		<td><textarea name="description" rows="2" cols="40" wrap="virtual">{$report->get_description()}</textarea></td>
	</tr>
	<tr>
		<td>Query:&nbsp;</td>
		<td><textarea name="query" rows="5" cols="40" wrap="virtual">{$report->get_query()}</textarea></td>
	</tr>
	<tr>
		<td colspan="2" align="center"><br>
		{if $report->id > 0}
		<input type="submit" name="submit" value="Update Report">
		{else}
		<input type="submit" name="submit" value="Add Report">
		{/if}
		</td>
	</tr>
</table>
	</fieldset>

	{if $report->id > 0}
	<fieldset class="radio">
		<h3>Report Templates</h3>
		<p>Click on a Title to edit the template</p>
		<table class="lumber" id="template">
			<tr>
				<th>Title</th>
				<!--<th>Download</th><th>Delete</th><th>Upload</th>-->
			</tr>
			{foreach from=$templates item=template}
			<tr>
				<td><input type="text" value="{$template.name}" size="20" name="templates[{$template.report_template_id}][name]"
					><input type="hidden" value="{$template.is_default}" name="templates[{$template.report_template_id}][is_default]"
					><input type="hidden" value="{$template.report_id}" name="templates[{$template.report_template_id}][report_id]">
				</td>
				{if $template.is_default == "yes"}
				<td>N/A</td>
				<td>N/A</td>
				<td>N/A</td>
				{else}
				<td><a href="{$DOWNLOAD_ACTION}template_id={$template.report_template_id}">Download</a></td>
				<td><input type="file" name="template[{$template.report_template_id}][file]" size="20"></td>
				<td><a OnClick="deleteTemplate(this,{$template.report_template_id}); return false;" href="#">Delete</a></td>
				{/if}
			</tr>
			{/foreach}
		</table>
		<input type="button" OnClick="addTemplate({$template.report_id});" value="Add a new Template" >
		<input type="submit" name="submit" value="Update Templates">
	</fieldset>
	{/if}
<input type="hidden" name="id" value="{$report->get_id()}">
<input type="hidden" name="process" value="{$PROCESS}">
</form>
</td></tr>
